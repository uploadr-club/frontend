<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Files - Uploadr.club</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css?h=ed0f9fbe99ee9c4c4c6250bf0ab5396c">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome5-overrides.min.css?h=a436bee1e5ae414f98db7ca13adfd7c0">
    <link rel="stylesheet" href="assets/css/styles.min.css?h=bb2db7521508fc7db3f11e7c02094a4a">
    {% include "base/web_panel.html" %}
</head>

<body id="page-top">
    <div id="wrapper">
        <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0">
            <div class="container-fluid d-flex flex-column p-0"><a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                    <div class="sidebar-brand-icon rotate-n-15"><img src="assets/img/logos/uploadr-logo-goyim.svg?h=b25cab0586ef382b73e5de4bc929da58" style="width: 45px;height: 42px;"></div>
                    <div class="sidebar-brand-text mx-3"><span>Uploadr</span></div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul class="navbar-nav text-light" id="accordionSidebar">
                    {% for page in pagemap %}
                        {% if user.perm_level >= page['perm_level'] %}
                            <li class="nav-item"><a class="nav-link {{ 'active' if page['active'] else '' }}" href="{{ '#' if page['active'] else page['url'] }}"><i class="{{ page['image_class'] }}"></i><span>{{ page['name'] }}</span></a></li>
                        {% endif %}
                    {% endfor %}
                </ul>
                <div class="row" style="margin-top: 15px;">
                    <div class="col text-center d-flex justify-content-xl-center"><i class="fas fa-sun d-xl-flex align-items-xl-center" style="font-size: 24px;margin-right: 8px;"></i><div class="custom-control custom-switch"><input class="custom-control-input" type="checkbox" id="darkSwitch" /><label class="custom-control-label" for="darkSwitch"></label></div><i class="fas fa-moon d-xl-flex align-items-xl-center" style="font-size: 24px;"></i></div>
                </div>
                <div class="text-center d-none d-md-inline"><button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button></div>
            </div>
        </nav>
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                    <div class="container-fluid"><button class="btn btn-link d-md-none rounded-circle mr-3" id="sidebarToggleTop" type="button"><i class="fas fa-bars"></i></button>
                        <ul class="navbar-nav flex-nowrap ml-auto">
                            <li class="nav-item dropdown d-sm-none no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-toggle="dropdown" href="#"><i class="fas fa-search"></i></a>
                                <div class="dropdown-menu dropdown-menu-right p-3 animated--grow-in" aria-labelledby="searchDropdown">
                                    <form class="form-inline mr-auto navbar-search w-100">
                                        <div class="input-group"><input class="bg-light form-control border-0 small" type="text" placeholder="Search for ...">
                                            <div class="input-group-append"><button class="btn btn-primary py-0" type="button"><i class="fas fa-search"></i></button></div>
                                        </div>
                                    </form>
                                </div>
                            </li>
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link" aria-expanded="false" data-toggle="dropdown" href="#"><span class="d-none d-lg-inline mr-2 text-gray-600 small">{{ user.name }}</span></a>
                                    <div class="dropdown-menu shadow dropdown-menu-right animated--grow-in"><a class="dropdown-item" href="/dash/profile"><i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>&nbsp;Settings</a><a class="dropdown-item" href="/dash/audit"><i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>&nbsp;Activity log</a>
                                        <div class="dropdown-divider"></div><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>&nbsp;Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
                <div class="container-fluid">
                    <h3 class="text-dark mb-4">Files</h3>
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <p class="text-primary m-0 font-weight-bold">Uploaded files</p><a id="delete-all" class="btn btn-danger btn-sm d-none d-sm-inline-block" role="button"><i class="fas fa-trash-alt text-white-50"></i>&nbsp;Delete all files</a>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive table mt-2" id="dataTable" role="grid" aria-describedby="dataTable_info">
                                <table class="table my-0" id="dataTable">
                                    <thead>
                                        <tr>
                                            <th>Filename</th>
                                            <th>IP of creation</th>
                                            <th>Filesize</th>
                                            <th>Views</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for image in images %}
                                            <tr id="{{ image.name }}">
                                                <td>{{ image.name }}{{ image.extension }}</td>
                                                <td>{{ image.ip }}</td>
                                                <td>{{ image.size }}</td>
                                                <td>{{ get_view_count(image.name) }}</td>
                                                <td><button class="btn btn-secondary" onclick="window.open('{{ user_url }}{{ image.name }}{{ image.extension }}', '_blank')"><i class="fas fa-share"></i></button>
                                                <button class="btn btn-primary copy" data-clipboard-text="{{ user_url }}{{ image.name }}{{ image.extension }}"><i class="fas fa-clipboard"></i></button>
                                                <button class="btn btn-danger delete" data-name="{{ image.name }}"><i class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td>N/A</td>
                                            <td>N/A</td>
                                            <td>N/A</td>
                                            <td>N/A</td>
                                            <td>None</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td><strong>Filename</strong></td>
                                            <td><strong>IP of creation</strong></td>
                                            <td><strong>Filesize</strong></td>
                                            <td><strong>Views</strong></td>
                                            <td><strong>Actions</strong></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <nav class="d-lg-flex justify-content-lg-end dataTables_paginate paging_simple_numbers">
                                        <ul class="pagination">
                                            <li class="page-item {{ "disabled" if not prev_page }}"><a class="page-link" href="{{ "/dash/files?page="+prev_page_num_str if prev_page else "#"}}" aria-label="Previous"><span aria-hidden="true">«</span></a></li>
                                            <li class="page-item {{ "disabled" if not next_page }}"><a class="page-link" href="{{ "/dash/files?page="+next_page_num_str if next_page else "#" }}" aria-label="Next"><span aria-hidden="true">»</span></a></li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="bg-white sticky-footer">
                <div class="container my-auto">
                    <div class="text-center my-auto copyright"><span>Copyright © Uploadr.club 2021</span></div>
                </div>
            </footer>
        </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.js"></script>
    <script src="assets/js/script.min.js?h=1e4be2044492a6ec5dc404d03b20a15b"></script>

<script src="/static/base_site/assets/js/clipboard.min.js"></script>
<script>
    var btns = document.querySelectorAll('.copy');
    for (var i = 0; i < btns.length; i++) {
        btns[i].addEventListener('mouseleave', clearTooltip);
        btns[i].addEventListener('blur', clearTooltip);
    }

    function clearTooltip(e) {
        e.currentTarget.setAttribute('class', 'copy btn btn-primary');
        e.currentTarget.removeAttribute('aria-label');
    }

    function showTooltip(elem, msg) {
        elem.setAttribute('class', 'copy btn btn-primary tooltipped tooltipped-s');
        elem.setAttribute('aria-label', msg);
    }

    function fallbackMessage(action) {
        var actionMsg = '';
        var actionKey = (action === 'cut' ? 'X' : 'C');
        if (/iPhone|iPad/i.test(navigator.userAgent)) {
            actionMsg = 'There is no support for copying on this device!';
        }
        else if (/Mac/i.test(navigator.userAgent)) {
            actionMsg = 'Press ⌘-' + actionKey + ' to ' + action;
        }
        else {
            actionMsg = 'Press Ctrl-' + actionKey + ' to ' + action;
        }
        return actionMsg;
    }

    var clipboard = new ClipboardJS('.copy');
    clipboard.on('success', function (e) {
        $(e.trigger).css("color", "#42f486");
        showTooltip(e.trigger, "Copied");
        window.setTimeout(function () {
            $(e.trigger).css("color", "dodgerblue");
        }, 2000)
    });
    clipboard.on('error', function (e) {
        showTooltip(e.trigger, fallbackMessage(e.action))
    });
    $("#delete-all").on('click', function () {
        if (confirm('Are you sure you want to delete all files?')) {
            $.post(window.location.href, {
                "action": "delete_all"
            }, function (p) {
                if (p.success) {
                    alert("Removed all files from database!");
                    window.location.reload()
                } else {
                    alert("Deletion failed.")
                }
            })
        } else {
            // Do nothing uwu
        }
    });
    $(".preview").on('click', function () {
        $("#preview-img").attr("src", "https://gitlab.has-bad.tech/3uuMk0J8A5rrUA.gif");
        let imgurl = $(this).data("img");
        $("#preview-img").attr("src", imgurl);
        $("#preview-modal").show()
    });
    $(".close").on('click', function () {
        $("#preview-modal").hide()
    });
    window.onclick = function (event) {
        if (event.target === $("#preview-modal")) {
            $("#preview-modal").hide();
        }
    };
    $(".delete").on('click', function () {
        var elm = $(this);
        elm.prop('disabled', true);
        var name = elm.data('name');
        $.post(window.location.href, {
            "action": "delete_one",
            "name": name
        }, function (p) {
            if (p.success) {
                elm.parent().parent().animate({opacity: 0}, "slow", function () {
                    elm.parent().parent().remove()
                })
            } else {
                alert("Deletion failed.")
            }
        })
    })
</script>
</body>

</html>